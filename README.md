# Generator Branded Go/GRPC Service

## Using this generator

This guide assumes you have Golang and NPM installed and configured.
Steps 1 - 4 only need to be done once.

### References

* [gRPC Go QuickStart](http://www.grpc.io/docs/quickstart/go.html)
* [gRPC gateway](https://github.com/grpc-ecosystem/grpc-gateway)
* [REST mapping docs](https://github.com/googleapis/googleapis/blob/master/google/api/http.proto)

1. Install Yeoman
    * `npm i -g yo`
1. Install the generator
    * `npm i -g generator-branded-go-service`
1. [Install gRPC protoc](https://github.com/google/protobuf/releases)
    * place the executable somewhere in your $PATH
1. Install grpc and grpc-gateway packages
    * `$ go get -u google.golang.org/grpc`
    * `$ go get -u github.com/golang/protobuf/protoc-gen-go`
    * `$ go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway`
    * `$ go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger`
1. Run the generator in the directory in your $GOPATH you want the project
    * `yo branded-go-service:server`
1. change name of gitignore file to .gitignore (yeoman has issues with gitignores)
1. Modify the .proto file to match your desired API contract.
1. Generate Go code
    * ```sh
      $ protoc -I/usr/local/include -I. \
      -I$GOPATH/src \
      -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis \
      --go_out=plugins=grpc:. \
      path/to/your_service.proto
1. Generate gateway code
    * ```sh
      $ protoc -I/usr/local/include -I. \
      -I$GOPATH/src \
      -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis \
      --grpc-gateway_out=logtostderr=true:. \
      path/to/your_service.proto
1. Generate swagger docs
    * ```sh
      $ protoc -I/usr/local/include -I. \
      -I$GOPATH/src \
      -I$GOPATH/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis \
      --swagger_out=logtostderr=true:. \
      path/to/your_service.proto
    * move the generated swagger.json file to the swagger directory
    * change url: in the SwaggerUIBundle function in swagger/index.html to the name of your swagger.json file
1. Generate TLS keys
    * `$ cd certs/test && make`
1. Install packages
    * `$ govendor sync`
1. In server/rpc.defs.go correctly implement your service methods
1. Change function names of your service as appropriate

## Notes

The Circle build and Docker file have not been tested yet. The first person to use this gets to be the guinea pig, yay! Specifically I have not worked on how to make the PEM and key in the cloud.

### This is a work in progress

Please contact @davesudia on Slack with improvements, or just [open a PR](https://jaxf-github.fanatics.corp/apparel/generator-branded-go-service)!

For deployment a dev/qc/prod PEM/Key will need to be generated.

## Client

Making a client that consumes this service over REST will use the REST endpoints generated by grpc-gateway. Consuming this service from a gRPC client can ignore the REST aspects completely. You do not need to generate the gateway code or swagger docs.
